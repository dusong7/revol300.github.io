---
layout: post
title:  "FFmpeg을 한번 써보자"
date:   2020-04-29
comments: true
excerpt: "ffmpeg tutorial"
categories: ffmpeg
tag:
- c
- multimedia 
- ffmpeg 
---
# Introduction 

[FFmpeg 라이브러리](http://www.yes24.com/Product/Goods/20365557)을 읽고 난뒤 예제를 그냥 읽기만 하는 것으로는 익숙해지기가 쉽지 않아서 해당 내용을 정리해보고자한다.

* 코드 출처는 [여기](https://github.com/sorrowhill/FFmpegTutorial)

# Scanning File

우선 전체 코드 부터!!

```c++
#include <libavformat/avformat.h>
#include <libavcodec/avcodec.h>
#include <stdio.h>

static AVFormatContext* fmt_ctx = NULL;

int main(int argc, char* argv[])
{
  unsigned int index;

  av_register_all();

  // Print debug log in library level.
  av_log_set_level(AV_LOG_DEBUG);

  if(argc < 2)
  {
    printf("usage : %s <input>\n", argv[0]);
    return 0;
  }

  // Get fmt_ctx from given file path. 
  if(avformat_open_input(&fmt_ctx, argv[1], NULL, NULL) < 0)
  {
    printf("Could not open input file %s\n", argv[1]);
    return -1;
  }

  // Find stream information from given fmt_ctx.
  if(avformat_find_stream_info(fmt_ctx, NULL) < 0)
  {
    printf("Failed to retrieve input stream information\n");
    return -2;
  }

  // fmt_ctx->nb_streams : number of total streams in video file.
  for(index = 0; index < fmt_ctx->nb_streams; index++)
  {
    AVCodecContext* avCodecContext = fmt_ctx->streams[index]->codec;
    if(avCodecContext->codec_type == AVMEDIA_TYPE_VIDEO)
    {
      printf("------- Video info -------\n");
      printf("codec_id : %d\n", avCodecContext->codec_id);
      printf("bitrate : %d\n", avCodecContext->bit_rate);
      printf("width : %d / height : %d\n", avCodecContext->width, avCodecContext->height);
    }
    else if(avCodecContext->codec_type == AVMEDIA_TYPE_AUDIO)
    {
      printf("------- Audio info -------\n");
      printf("codec_id : %d\n", avCodecContext->codec_id);
      printf("bitrate : %d\n", avCodecContext->bit_rate);
      printf("sample_rate : %d\n", avCodecContext->sample_rate);
      printf("number of channels : %d\n", avCodecContext->channels);
    }
  } // for

  if(fmt_ctx != NULL)
  {
    avformat_close_input(&fmt_ctx);
  }

  return 0;
}
```

해당 프로그램이 하고자 하는 일은 파일의 Video정보와 Audio정보를 얻어오는 것이다.

각 함수의 뜻을 살펴보자
av_register_all() : Initialize libavformat and register all muxers, demuxers and protocols

If you do not call this function, then you can select exactly which format you want to support.

av_log_set_level(AV_LOG_DEBUG) : set log level
log level 에는 AV_LOG_QUIET AV_LOG_PANIC AV_LOG_FATAL AV_LOG_ERROR AV_LOG_WARNING AV_LOG_INFO AV_LOG_VERBOSE AV_LOG_DEBUG 가 사용 가능하다.

avformat_find_stream_info (AVFormatContext *ic, AVDictionary **options) : Read packet of a media file to get stream information. This is useful for file format with no header such as MPEG. This function also computes the real framerate in case of MPEG-2 repeat frame mode. The logical file position is not changed by this function; examined packets may be buffered for laterprocessing.

avformat_close_input (AVFormatContext** s) : Close an opened input AVFormatContext. Free it and all its contents and set *s to NULL


